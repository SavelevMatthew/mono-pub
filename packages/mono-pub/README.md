<img src="https://i.imgur.com/EfCWy6d.png" style="max-height: 200px; width: 100%; object-fit: contain;" alt="Mono-Pub logo"/>

<p align="center">
    <a href="https://www.npmjs.com/package/mono-pub">
        <img alt="npm" src="https://img.shields.io/npm/v/mono-pub?logo=npm&logoColor=white&style=flat-square">
    </a>
    <a href="https://github.com/SavelevMatthew/mono-pub/actions/workflows/test.yml?query=branch%3Amain">
        <img alt="GitHub Workflow Status (with branch)" src="https://img.shields.io/github/actions/workflow/status/SavelevMatthew/mono-pub/test.yml?branch=main&label=test&logo=github&style=flat-square">
    </a>
    <a href="https://github.com/SavelevMatthew/mono-pub/discussions">
        <img alt="Join the community on GitHub Discussions" src="https://img.shields.io/badge/Join%20the%20community-on%20GitHub%20Discussions-blue?style=flat-square">
    </a>
    <a href="https://github.com/prettier/prettier">
        <img src="https://img.shields.io/badge/code_style-prettier-ff69b4.svg" alt="prettier badge">
    </a>
    <a href="https://github.com/SavelevMatthew/mono-pub">
        <img alt="Mono-Pub released" src="https://img.shields.io/badge/Mono--Pub-released-46BCFF?logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAGxklEQVR4nO1aXagdVxX%2B1lp75hy13kqslIhWsKRKsdoiqA9VFIqtiFC1QRGpUlAfohJQsYig%2FcmLD4rVByEPNiLVNPUH%2FIsRcqFWKf2BNFgTq6UN1B9Qk0Dk9s7svdfy4c4Mk3PnnDPnnDmZG3I%2F2Nw7Z%2Fbea%2B1v1l577bU3mRkuZXDfCvSNbQL6VqBvbBPQtwJ9Y5uAvhXoG5c8Aa78x3vfWKEMlIgIqgpmhpnBzCAi1XMbENGm59H%2BAexk5vuJ6D1m9lMz%2Bz2AVQB%2FHtevmW3quwnMm783lQpsBQLM7E5mvheANDT%2Fu5kdMbNHAfwOwHN1HS9KAmrKf5CZ7wPwmlYdbbR7DsBhVX0MwGEi%2Bte0NluOACJ6K4D9RHRDqw7GwMxyVb0ewIlJ9UQ2G1ZvTpCI7iGiJxYdfNFXCuCmedq66VW6Q2EpbxGRgwDe0GXfIrJjnnYX0gJSIvqeiBxDx4Mv8LZyao4rTejEAurOZZwgIjpORMsYeIm3A3gJgBdnabQQAWaGGCOADQdDRGOdIhGtLSKrBVZU9ZUAXhhXoXMnSETV6uC9R5ZlCCFU6%2FtIObSIrBZIzGziNGhCZz6gHHQIAWYGZj6vENGRrmSNg4jsEhHUi3OuKk3ojIBy0AAQQoCqwsygqmV5ysxOdSWvCUT0utIqyzINna4CZUhqZlVgVVMmENHBLuU14KZRs%2FfeY319HXmeNzZYyjJIRPDeY21tw%2B%2FFGBFjRAjhT8uQV8NOM1sBUFnepPkPLDEOKEnIsqz%2B888BnFuWTACXqeo1deur%2F21CJwSUAsyMVJXrv4UQNgRtOMJzqvpkFzIn6PJ1M3tz2%2F1JJwQUZnaNc%2B7HaZqeBnBrsbevLCHP89IXHO1C5jiIyPsHg8FTRcR5y7QpMPduUFXL4OdjRPQlEbm%2B3i7Lsp%2Bsra19SkTOJElS1U%2FT9FXM%2FDyAl3Yw3qmIMT6S5%2FkHmPnsYDDY9H5mAgovT0S0J0mSrxLRlROEa4zxQVU9rKrnVDVJ03RnmqZ3AVjpYHytoKp%2FUNWPO%2BeeH33XmoCiI4jIJ5xz3ySiuXZffSHLsk8OBoMDo7%2B32gsUpn9VkiQ%2FFJF3dq%2FecmFmmZmdbXo31QkWEd6eNE1PXYyDBwAz%2B1GSJL9sejfRAoq01wHn3O3LUW35KBz2twHEpveVBYxuXpi5zPmtqurjZtYcS25xhBD2ee%2BPlfHIKConWO7rmxBjBDNfAeAzIvJlInp5kywAHhtJiS2BGOORPM9vLoOy4XC4qU6rQKgIYP6jqvtCCFeZ2XcAVMuDqr6wvr7%2B6izLXpHn%2BaEYY%2B%2FXTszsWe%2F9R6bVmycSPKuqn48x7lDVH8QY7%2FPevxbAG51zDwC4QlWXuu2dBjNb997vBnB22pa4mgKjc6Se7RGRKtEhIlVEqKplDu5W59zP2uy%2Flw0z%2B0eM8X1mdnx0WjdNgZlyggVZNzLz95l5h4hw0cdl86vcHczst2Z2yyxtZiHgTc65B0Tkuhn1uiCIMd5NRF%2BbtV0bAq4GsCdJkjsAXD6zZkuGqp5Q1d1E9PQ87ccSUAQQ14rIk0S0efL0DDM7bWZ3xhj3A5OTHpMwdhUgon0icpSZt9TgCyf3uRDClaq6v23ycxwqCxhJGrzDOfeVBfTsHGb2RzP7lqo%2BVCZf61v0eXEeAWXHzrm7OlL6nwBeRkTz7P2fAfCo9%2F4ZInqQiP4KzG%2Fq47DJApj5EDO%2Fd94OVfUvAI4R0f0hhHXn3K%2FatDOz42b2CwCnzexhEXmibpX12yRdoiIghIDhcLhXRG6bpyNVfdbM9hKRA7ALwIpz7l4impj6MrP%2FqepnARwog64LiYqAJEluBvBpVV0lol1E1Oq6iqqeUtUvqupDzPxuEVltK1xV%2FxtjvJGZTy7qzOZFRQAzr8YYbwCQYeMs%2Fx7n3LtU9RAAz8wrAD5kZlcTEXnv7y7u9UTdAETkC7MIV9XbiOhkpyOaEWNzgsUWuDJJZkaMUcyMASCE4NM0rR%2BDXTccDo%2B3%2FYohhIOq%2BtFybotIdb5Yfy5Pm%2BvH7k2J2roFlSdCC%2B0FmkySiCKKzEqpeKmAiOye0YS%2F2%2BbkZtlY6IJEnufl0vn6NE33tm2nqo%2Br6iP1gZdfq%2Bkq2zIxFwHFF6%2FMVES%2BwcxNWaLzoKqPmdmxEML%2BpgCmjEMu5ErQmoC6svW7AAB2i8iHR%2Bub2RqAf5vZr1X1BDP%2FRlX%2Ftmjk1jVaEVA6m%2FK8Dzg%2FdI4xHmXmh4noTIzxjJmddM49DeBFVe09PTYJtIzo6mLCJX9dfpuAvhXoG9sE9K1A39gmoG8F%2BsY2AX0r0Df%2BD8hPIGBxckirAAAAAElFTkSuQmCC">
    </a>
</p>
<h3 align="center">Simple tool for publishing your Typescript and Javascript packages living in mono-repo.</h3>
<p align="center">
    Inspired by <a href="https://github.com/semantic-release/semantic-release">semantic-release</a>
</p>

## Table of contents:
- [About mono-pub](#about-mono-pub)
- [What's the difference from semantic-release?](#whats-the-difference-from-semantic-release)
- [About plugins and publishing workflow](#about-plugins-and-publishing-workflow)
- [List of popular plugins](#list-of-popular-plugins)
- [Basic usage examples](#basic-usage-examples)
- [Mono-pub community](#mono-pub-community)

## About mono-pub

Mono-pub is a utility that allows you to automatically release JS packages from your CI/CD pipeline.

The release process basically consists of the following steps:
1. For each package the last published version is determined, 
as well as the list of commits that happened since the last publication, affecting this package.
2. Based on these commits, the next version for each package is determined.
3. A dependency graph is constructed to determine the publication order.
4. Packages are assembled and published in single or multiple destinations one by one.
5. After each package is published, the specified side effects are performed 
(Fixing the published version, generating release-note, sending web-hooks, and any other ideas you have)

## What's the difference from semantic-release?

Mono-pub is focused on mono-repositories. Because of this, there are a number of 
significant design differences:
1. **Dependency graph.** It is important to us that packages are **published 
in the right order**, so we build a dependency graph to determine the order of publication, 
whereas other popular semantic-release-based forks only run it in multiple threads, 
which can lead to a situation where the new version of a package is published 
before its dependency, thereby breaking the installation process.
2. **Taking the tag creation out of the optional "postPublish" step.** 
In semantic-release, the creation of a new tag takes place before the package is published. 
This is not very obvious, allowing you to skip some of the changes in the repositories, 
where there is constant feature delivery. In Mono-Pub this step happens only after the successful publishing of a package, allowing you to re-run your workflows.
3. **Working with squash commits.** Often a developer needs to make changes to several packages and applications as part of a single task. 
This forced either abandoning the squash commit policy to get the history correct, 
thereby increasing the repository runtime due to the large history, 
or heavily dodging to make it work with the current solutions. 
The mono-pub plugins handle this out of the box (See [`@mono-pub/github`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/github) for example)

## About plugins and publishing workflow

We divide the publishing process into several steps, 
allowing you to control most of the process yourself through pre-made plugins or using your own.

| Step             | Description                                                                                                                                              |
|------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------|
| Setup            | Sets up the plugin, checks all the conditions necessary for work.                                                                                        |
| Get Last Release | Obtains latest released version for each package (Usually from tags analysis)                                                                            |
| Extract commits  | Extracts commits relevant to specific package that happened since last release                                                                           |
| Get Release Type | Based on the received data and updated dependencies,  calculates the release type according to semantic versioning                                       |
| Prepare          | Performs any action that prepares all packages for publication after all versions are patched  (You can build packages here, omit devDeps, you name it). |
| Publish          | Publishes individual package to destination                                                                                                              |
| Post-Publish     | Performs any actions on successful publishing  (You can generate new tag, publish release notes, send web hooks and every other side effect here)        |

> All plugins must implement MonoPubPlugin interface, containing plugin name and implementation of one or more specified steps.
> Detailed interface description can be found [here](https://github.com/SavelevMatthew/mono-pub/blob/main/packages/mono-pub/src/types/plugins.ts) 
> or can be directly imported from package:

```typescript
import { MonoPubPlugin } from 'mono-pub'
```

## List of popular plugins

- [`@mono-pub/git`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/git) -
  Searches the last git tag for each package and finds commits affecting that package. 
Publishes a new tag after it has been published.
- [`@mono-pub/github`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/github) -
  Responsible for interacting with the Github: it can fetch commits from PR (in case of squash) 
, generate and publish release notes afterward via [conventional-commits-parser](https://www.npmjs.com/package/conventional-commits-parser). Used on top of `@mono-pub/git`.
- [`@mono-pub/commit-analyzer`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/commit-analyzer) -
 Parses commits via [conventional-commits-parser](https://www.npmjs.com/package/conventional-commits-parser) 
and determines next release version
- [`@mono-pub/npm`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/npm) - 
 Publishes packages to npm registry

> To see all possible plugin settings, check the README of the plugin of interest.


## Basic usage examples

Below is a basic example of `publish.js` script, which publishes packages to the standard npm registry 
from the Git repository. Note, that all packages here are built via [turbo](https://github.com/vercel/turbo) before publishing: 

```javascript
const execa = require('execa')
const publish = require('mono-pub')
const git = require('@mono-pub/git')
const npm = require('@mono-pub/npm')
const commitAnalyzer = require('@mono-pub/commit-analyzer')

const builder = {
    name: '@mono-pub/local-builder',
    async prepare(_, ctx) {
        await execa('yarn', ['build'], { cwd: ctx.cwd })
    },
}

publish(
    ['packages/*'],
    [
        git(),
        commitAnalyzer(),
        builder,
        npm(),
    ]
)

```

To publish packages just run it from your CI/CD provider. For example, GitHub Action pipeline can be used like this.
```yaml
  - name: Run publish script
    run: node bin/publish.js
    env:
      NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
```

And there's advanced example. 

[`@mono-pub/github`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/github) 
is responsible for replacing commits with PR mentioned in header via standard github squash rule  (ends with `(#123)`) 
with original PR commits (only commits affecting package is picked). It's also publish release notes in `postPublish` step.

[`@mono-pub/npm`](https://github.com/SavelevMatthew/mono-pub/tree/main/packages/npm) is used with `provenance` option, which can sign your publication, 
when used in GitHub Actions CI.

```javascript
const execa = require('execa')
const publish = require('mono-pub')
const git = require('@mono-pub/git')
const github = require('@mono-pub/github')
const npm = require('@mono-pub/npm')
const commitAnalyzer = require('@mono-pub/commit-analyzer')

const builder = {
    name: '@mono-pub/local-builder',
    async prepare(_, ctx) {
        await execa('yarn', ['build'], { cwd: ctx.cwd })
    },
}

const BREAKING_KEYWORDS = ['BREAKING CHANGE', 'BREAKING-CHANGE', 'BREAKING CHANGES', 'BREAKING-CHANGES']

publish(
    ['packages/*'],
    [
        git(),
        github({
            extractCommitsFromSquashed: true,
            releaseNotesOptions: {
                rules: [
                    { breaking: true, section: '‚ö†Ô∏è BREAKING CHANGES' },
                    { type: 'feat', section: 'ü¶ï New features' },
                    { type: 'fix', section: 'üêû Bug fixes' },
                    { type: 'perf', section: 'üöÄ Performance increases' },
                    { dependency: true, section: 'üåêDependencies' },
                ],
                breakingNoteKeywords: BREAKING_KEYWORDS,
            },
        }),
        commitAnalyzer({
            minorTypes: ['feat'],
            patchTypes: ['perf', 'fix'],
            breakingNoteKeywords: BREAKING_KEYWORDS,
        }),
        builder,
        npm({ provenance: true }),
    ]
)
```

## Mono-pub community

You can support the project with 2 simple things:
1. Tell others about it, so we can develop it together.
2. Post a badge below saying to use mono-pub to release your packages

<a href="https://github.com/SavelevMatthew/mono-pub">
    <img alt="Mono-Pub released" src="https://img.shields.io/badge/Mono--Pub-released-46BCFF?logo=data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAAC4jAAAuIwF4pT92AAAGxklEQVR4nO1aXagdVxX%2B1lp75hy13kqslIhWsKRKsdoiqA9VFIqtiFC1QRGpUlAfohJQsYig%2FcmLD4rVByEPNiLVNPUH%2FIsRcqFWKf2BNFgTq6UN1B9Qk0Dk9s7svdfy4c4Mk3PnnDPnnDmZG3I%2F2Nw7Z%2Fbea%2B1v1l577bU3mRkuZXDfCvSNbQL6VqBvbBPQtwJ9Y5uAvhXoG5c8Aa78x3vfWKEMlIgIqgpmhpnBzCAi1XMbENGm59H%2BAexk5vuJ6D1m9lMz%2Bz2AVQB%2FHtevmW3quwnMm783lQpsBQLM7E5mvheANDT%2Fu5kdMbNHAfwOwHN1HS9KAmrKf5CZ7wPwmlYdbbR7DsBhVX0MwGEi%2Bte0NluOACJ6K4D9RHRDqw7GwMxyVb0ewIlJ9UQ2G1ZvTpCI7iGiJxYdfNFXCuCmedq66VW6Q2EpbxGRgwDe0GXfIrJjnnYX0gJSIvqeiBxDx4Mv8LZyao4rTejEAurOZZwgIjpORMsYeIm3A3gJgBdnabQQAWaGGCOADQdDRGOdIhGtLSKrBVZU9ZUAXhhXoXMnSETV6uC9R5ZlCCFU6%2FtIObSIrBZIzGziNGhCZz6gHHQIAWYGZj6vENGRrmSNg4jsEhHUi3OuKk3ojIBy0AAQQoCqwsygqmV5ysxOdSWvCUT0utIqyzINna4CZUhqZlVgVVMmENHBLuU14KZRs%2FfeY319HXmeNzZYyjJIRPDeY21tw%2B%2FFGBFjRAjhT8uQV8NOM1sBUFnepPkPLDEOKEnIsqz%2B888BnFuWTACXqeo1deur%2F21CJwSUAsyMVJXrv4UQNgRtOMJzqvpkFzIn6PJ1M3tz2%2F1JJwQUZnaNc%2B7HaZqeBnBrsbevLCHP89IXHO1C5jiIyPsHg8FTRcR5y7QpMPduUFXL4OdjRPQlEbm%2B3i7Lsp%2Bsra19SkTOJElS1U%2FT9FXM%2FDyAl3Yw3qmIMT6S5%2FkHmPnsYDDY9H5mAgovT0S0J0mSrxLRlROEa4zxQVU9rKrnVDVJ03RnmqZ3AVjpYHytoKp%2FUNWPO%2BeeH33XmoCiI4jIJ5xz3ySiuXZffSHLsk8OBoMDo7%2B32gsUpn9VkiQ%2FFJF3dq%2FecmFmmZmdbXo31QkWEd6eNE1PXYyDBwAz%2B1GSJL9sejfRAoq01wHn3O3LUW35KBz2twHEpveVBYxuXpi5zPmtqurjZtYcS25xhBD2ee%2BPlfHIKConWO7rmxBjBDNfAeAzIvJlInp5kywAHhtJiS2BGOORPM9vLoOy4XC4qU6rQKgIYP6jqvtCCFeZ2XcAVMuDqr6wvr7%2B6izLXpHn%2BaEYY%2B%2FXTszsWe%2F9R6bVmycSPKuqn48x7lDVH8QY7%2FPevxbAG51zDwC4QlWXuu2dBjNb997vBnB22pa4mgKjc6Se7RGRKtEhIlVEqKplDu5W59zP2uy%2Flw0z%2B0eM8X1mdnx0WjdNgZlyggVZNzLz95l5h4hw0cdl86vcHczst2Z2yyxtZiHgTc65B0Tkuhn1uiCIMd5NRF%2BbtV0bAq4GsCdJkjsAXD6zZkuGqp5Q1d1E9PQ87ccSUAQQ14rIk0S0efL0DDM7bWZ3xhj3A5OTHpMwdhUgon0icpSZt9TgCyf3uRDClaq6v23ycxwqCxhJGrzDOfeVBfTsHGb2RzP7lqo%2BVCZf61v0eXEeAWXHzrm7OlL6nwBeRkTz7P2fAfCo9%2F4ZInqQiP4KzG%2Fq47DJApj5EDO%2Fd94OVfUvAI4R0f0hhHXn3K%2FatDOz42b2CwCnzexhEXmibpX12yRdoiIghIDhcLhXRG6bpyNVfdbM9hKRA7ALwIpz7l4impj6MrP%2FqepnARwog64LiYqAJEluBvBpVV0lol1E1Oq6iqqeUtUvqupDzPxuEVltK1xV%2FxtjvJGZTy7qzOZFRQAzr8YYbwCQYeMs%2Fx7n3LtU9RAAz8wrAD5kZlcTEXnv7y7u9UTdAETkC7MIV9XbiOhkpyOaEWNzgsUWuDJJZkaMUcyMASCE4NM0rR%2BDXTccDo%2B3%2FYohhIOq%2BtFybotIdb5Yfy5Pm%2BvH7k2J2roFlSdCC%2B0FmkySiCKKzEqpeKmAiOye0YS%2F2%2BbkZtlY6IJEnufl0vn6NE33tm2nqo%2Br6iP1gZdfq%2Bkq2zIxFwHFF6%2FMVES%2BwcxNWaLzoKqPmdmxEML%2BpgCmjEMu5ErQmoC6svW7AAB2i8iHR%2Bub2RqAf5vZr1X1BDP%2FRlX%2Ftmjk1jVaEVA6m%2FK8Dzg%2FdI4xHmXmh4noTIzxjJmddM49DeBFVe09PTYJtIzo6mLCJX9dfpuAvhXoG9sE9K1A39gmoG8F%2BsY2AX0r0Df%2BD8hPIGBxckirAAAAAElFTkSuQmCC">
</a>

> Want to share an idea for a feature or plugin? 
> Or share your mono-pub journey and end up on the honorary adopters list here? 
> Feel free to be a participant in the [project discussions](https://github.com/SavelevMatthew/mono-pub/discussions)

